## 事务传播行为

### Propagation.REQUIRED(默认)(事务运行)

```text
如果当前存在事务，则加入该事务；
如果当前没有事务，则创建一个事务并加入
```

```text
内外事务处于同一个事务中，只要异常上抛到有使用注解的方法，那么整个事务都会回滚
```

## Propagation.SUPPORTS(有就事务，没有就非事务)

```text
如果当前存在事务，则加入该事务； 
如果当前没有事务，则以非事务方式运行
```

## Propagation.MANDATORY(事务运行)

```text
如果当前存在事务，则加入该事务； 
如果当前没有事务，则抛出异常
```

## Propagation.REQUIRES_NEW(独立事务)

```text
如果当前存在事务，将事务挂起，创建新事务并加入；
如果当前没有事务，则创建新事务并加入
```

## Propagation.NOT_SUPPORTED(非事务运行)

```text
如果当前存在事务，将事务挂起，以非事务方式运行； 
如果当前没有事务，则以非事务方式运行

```

## Propagation.NEVER(非事务运行)

```text
如果当前存在事务，则抛出异常；
如果当前没有事务，则以非事务方式运行
```

## Propagation.NESTED(嵌套事务)

```text
如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行； 
如果当前没有事务，则该取值等价于Propagation.REQUIRED
```

## 比较

定义serviceA.methodA()以PROPAGATION_REQUIRED修饰； 定义serviceB.methodB()以表格中三种方式修饰；

```text
methodA中调用methodB
---------------------------------------------------------------------------------------------------------------------------
异常状态	        PROPAGATION_REQUIRES_NEW	                          PROPAGATION_NESTED 	            PROPAGATION_REQUIRED
                    （两个独立事务）                                  (B的事务嵌套在A的事务中)              (同一个事务)
---------------------------------------------------------------------------------------------------------------------------
methodA抛异常
methodB正常	    B先提交，A再回滚	                                       A与B一起回滚	                        A与B一起回滚
---------------------------------------------------------------------------------------------------------------------------
methodA正常
methodB抛异常	1.如果A中捕获B的异常，                                 1.A中捕获B的异常，
                并没有继续向上抛异常，则B先回滚，A再正常提交；              B先回滚，A再正常提交
                2.如果A未捕获B的异常，                                 2.A未捕获B的异常，
                默认则会将B的异常向上抛，则B先回滚，A再回滚	               A与B一起回滚	    	                A与B一起回滚
---------------------------------------------------------------------------------------------------------------------------
methodA抛异常
methodB抛异常	B先回滚，A再回滚	                                        A与B一起回滚	                        A与B一起回滚
---------------------------------------------------------------------------------------------------------------------------
methodA正常
methodB正常	    B先提交，A再提交	                                        A与B一起提交	                        A与B一起提交
---------------------------------------------------------------------------------------------------------------------------
```























